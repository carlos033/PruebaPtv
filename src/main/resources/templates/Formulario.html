<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html xmlns:th="http://www.thymeleaf.org">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>All Clientes</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    </head>
    <style>
        canvas{ border: 1px solid black; }
    </style>
    <script type="text/javascript">
        function signatureCapture() {
            var canvas = document.getElementById("newSignature");
            var context = canvas.getContext("2d");
            canvas.width = 276;
            canvas.height = 180;
            context.fillStyle = "#fff";
            context.strokeStyle = "#444";
            context.lineWidth = 1.5;
            context.lineCap = "round";
            context.fillRect(0, 0, canvas.width, canvas.height);
            var disableSave = true;
            var pixels = [];
            var cpixels = [];
            var xyLast = {};
            var xyAddLast = {};
            var calculate = false;
            {   //functions
                function remove_event_listeners() {
                    canvas.removeEventListener('mousemove', on_mousemove, false);
                    canvas.removeEventListener('mouseup', on_mouseup, false);
                    canvas.removeEventListener('touchmove', on_mousemove, false);
                    canvas.removeEventListener('touchend', on_mouseup, false);
                    document.body.removeEventListener('mouseup', on_mouseup, false);
                    document.body.removeEventListener('touchend', on_mouseup, false);
                }

                function get_coords(e) {
                    var x, y;

                    if (e.changedTouches && e.changedTouches[0]) {
                        var offsety = canvas.offsetTop || 0;
                        var offsetx = canvas.offsetLeft || 0;

                        x = e.changedTouches[0].pageX - offsetx;
                        y = e.changedTouches[0].pageY - offsety;
                    } else if (e.layerX || 0 == e.layerX) {
                        x = e.layerX;
                        y = e.layerY;
                    } else if (e.offsetX || 0 == e.offsetX) {
                        x = e.offsetX;
                        y = e.offsetY;
                    }

                    return {
                        x: x, y: y
                    };
                }
                ;
                function on_mousedown(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    canvas.addEventListener('mouseup', on_mouseup, false);
                    canvas.addEventListener('mousemove', on_mousemove, false);
                    canvas.addEventListener('touchend', on_mouseup, false);
                    canvas.addEventListener('touchmove', on_mousemove, false);
                    document.body.addEventListener('mouseup', on_mouseup, false);
                    document.body.addEventListener('touchend', on_mouseup, false);
                    empty = false;
                    var xy = get_coords(e);
                    context.beginPath();
                    pixels.push('moveStart');
                    context.moveTo(xy.x, xy.y);
                    pixels.push(xy.x, xy.y);
                    xyLast = xy;
                }
                ;
                function on_mousemove(e, finish) {
                    e.preventDefault();
                    e.stopPropagation();
                    var xy = get_coords(e);
                    var xyAdd = {
                        x: (xyLast.x + xy.x) / 2,
                        y: (xyLast.y + xy.y) / 2
                    };
                    if (calculate) {
                        var xLast = (xyAddLast.x + xyLast.x + xyAdd.x) / 3;
                        var yLast = (xyAddLast.y + xyLast.y + xyAdd.y) / 3;
                        pixels.push(xLast, yLast);
                    } else {
                        calculate = true;
                    }
                    context.quadraticCurveTo(xyLast.x, xyLast.y, xyAdd.x, xyAdd.y);
                    pixels.push(xyAdd.x, xyAdd.y);
                    context.stroke();
                    context.beginPath();
                    context.moveTo(xyAdd.x, xyAdd.y);
                    xyAddLast = xyAdd;
                    xyLast = xy;
                }
                ;
                function on_mouseup(e) {
                    remove_event_listeners();
                    disableSave = false;
                    context.stroke();
                    pixels.push('e');
                    calculate = false;
                }
                ;
            }
            canvas.addEventListener('touchstart', on_mousedown, false);
            canvas.addEventListener('mousedown', on_mousedown, false);
        }

        function signatureSave() {
            var canvas = document.getElementById("newSignature");// save canvas image as data url (png format by default)
            var dataURL = canvas.toDataURL("image/png");
            document.getElementById("saveSignature").src = dataURL;
        }
        ;

        function signatureClear() {
            var canvas = document.getElementById("newSignature");
            var context = canvas.getContext("2d");
            context.clearRect(0, 0, canvas.width, canvas.height);
        }

        function guardar() {
            var canvas = document.getElementById("newSignature");
            var img = canvas.toDataURL("image/png");
            document.getElementById("imagen").value = img;
            document.getElementById("formularioGuardar").submit();
        }
    </script>
    <body onload="init()">
        <form id="formularioGuardar" method="POST" action="/guardar">
            <input type="hidden" th:value="${usuario.nombre}" name="nombre">
            <input type="hidden" th:value="${usuario.email}" name="correo">
            <input type="hidden" value="" id="imagen" name="imagen">
            </br>  </br>
            <h1 class="text-center header">Datos empleado</h1>
            <div class="container my-2">
                <div>
                    <button type="button" onclick="guardar()">Guardar</button>
                </div>
                <div class="card-body">
                    Nombre:<p th:text="${usuario.nombre}"></p>
                    Email:<p th:text="${usuario.email}"></p>
                    <div class="contenedor" aling="center">
                        <h3 aling="center">Firma</h3>
                        <div class="row"> 
                            <button type="button" onclick="signatureClear()">Eliminar Firma</button>
                            <div class="col-md-1" aling="center">
                                <canvas id="newSignature" aling="center" width="200" height="200" style="position:absolute;top:10%;left:10%;border:2px solid;"></canvas>
                                <script>signatureCapture();</script><script>signatureCapture();</script>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </body>
</html>